# scripts — Deployment & Operations

## What is this

Shell scripts for deploying, initializing, and interacting with ZKachi contracts on Stellar testnet.

## Scripts

### `deploy.sh` — Deploy all contracts

Builds WASM and deploys pool, verifier, and roulette contracts. Saves contract IDs to `.env`.

```bash
make deploy
# or: bash scripts/deploy.sh
```

**Prerequisites:** `stellar` CLI installed, funded testnet account (default identity)

### `init.sh` — Initialize contracts

Calls constructors on all three contracts to set up cross-references (pool ↔ roulette ↔ verifier ↔ hub).

```bash
make init
# or: bash scripts/init.sh
```

**Prerequisites:** `deploy.sh` must have run first (reads `.env` for contract IDs)

### `seed-pool.sh` — Add initial liquidity

Deposits XLM into the pool as the admin LP.

```bash
make seed
# or: bash scripts/seed-pool.sh [amount_stroops]
# Default: 10,000,000,000 stroops (1000 XLM)
```

### `play-round.sh` — Manual round test

Walks through a commit → bet → reveal flow via CLI. Note: the reveal step requires a valid ZK proof from the circuit pipeline.

```bash
make play
# or: bash scripts/play-round.sh
```

## Execution order

```
1. make deploy    # Deploy contracts, creates .env
2. make init      # Initialize cross-references
3. make seed      # Add liquidity to pool
4. make play      # Test a round (needs ZK proof)
```

## Environment variables

Scripts read from `.env` in the project root:

| Variable | Description |
|----------|-------------|
| `POOL_ID` | Pool contract address |
| `VERIFIER_ID` | Verifier contract address |
| `ROULETTE_ID` | Roulette contract address |

## Hardcoded values

- **Hub contract:** `CB4VZAT2U3UC6XFK3N23SKRF2NDCMP3QHJYMCHHFMZO7MRQO6DQ2EMYG` (in deploy.sh)
- **Native XLM SAC:** `CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHQBER` (testnet, in init.sh)
- **Bond amount:** 500,000,000 stroops (50 XLM) in play-round.sh

## Pitfalls

- Scripts assume the `stellar` CLI default identity is funded on testnet
- `.env` is gitignored — it's generated by `deploy.sh`
- The play script cannot complete the reveal step without a real ZK proof
- Contract IDs change on every deploy — always re-run `init.sh` after `deploy.sh`
